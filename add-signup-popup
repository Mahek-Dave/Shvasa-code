// IIFE function
(()=>{
    let iframeAdded = false;
    let popup;

// Get url to fetch UTM paras
const pageUrl=encodeURIComponent(window.location.href);

// Signup iframe
const iframeHTML = `<iframe class="signup-popup" src="https://shvasa-staging-web.vercel.app/widgets?widget=loginPopup&url=${pageUrl}"></iframe>`;

// Add popup to body
const addPopup = (html) => document.body.insertAdjacentHTML("beforeend", html);

// Add popup after page loads
window.addEventListener('load', function(){
    addPopup(iframeHTML);
});

    // Elements
    const allBtns = [...document.querySelectorAll(".free-trial-wrapper")];
    const closeBtn = document.querySelector(".close-signup-popup");
    
    // display popup
    const showPopup = () =>{
         closeBtn.style.display = "flex";
         popup = document.querySelector(".signup-popup");
         popup.style.display = 'flex';
    };
    
    // hide popup
    const closePopup = () => {
    popup.style.display = 'none';
    closeBtn.style.display = "none";
    }
    
    // Events
    allBtns.forEach(btn=> btn.addEventListener("click",showPopup))
    closeBtn.addEventListener("click", closePopup);
    
    window.addEventListener('message', function(event) {
        console.log("Message received from the child: " + JSON.stringify(event.data)); // Message received from child
        if(event.data?.event === 'loggedIn'){
            window.location='https://shvasa-staging-web.vercel.app/dashboard?widget=loginpopup&token='+event.data?.token
        }
      }); 
})();
